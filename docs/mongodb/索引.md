





## 安装















## 登录



mongo



> use admin
> switched to db admin
>
> db.auth('admin', '123456')
>
> 1



文档

http://c.biancheng.net/view/6542.html



# MongoDB索引完全攻略

http://c.biancheng.net/view/6558.html





## 使用索引时的注意事项



Mongdb在提升查询效率上是很有帮助，但是在实际使用中也不要滥用，否则会适得其反，下面总结几点，供参考：

索引创建时最好作用于取值丰富的字段，有限值的字段就没必要添加索引；

经常排序的字段，可以考虑添加索引；

一个集合中索引的个数不是越多越好，需要根据实际情况来定；

执行接口慢，有可能是缺少索引（查询慢），也有可能是索引使用不当（编辑慢）；

复合索引在使用时，一定要结合索引字段的顺序使用。





索引可以提高查询速度，但是它不是万金油，它也有自己的缺点，就是修改索引字段的写操作（插入、更新和删除），会花费更长的时间。这是因为在更改数据时，除了更新文档，MongoDB还要更新索引。但通常来讲，这个代价是值得的。



为哪些字段建立索引：

经常查询的字段，或者存在性能瓶颈的字段。





从 mongoDB 3.0 开始，ensureIndex 被废弃，今后都仅仅是 createIndex 的一个别名。



索引：一是寻找快，二是不能重复。

文档是没有顺序的，索引是有顺序排列的。



创建索引：

db.book.ensureIndex({"title": 1})

创建二级索引？？？

db.book.ensureIndex({"author.name": 1})



创建唯一性索引：

db.book.ensureIndex({"title": 1}, {unique: true})





查看索引：

db.users.getIndexed()







《MongoDB进阶与实战：微服务整合、性能优化。架构管理》

4.5 唯一性约束

唯一性索引对于文档中缺失









## __v

"__v"是"versionKey"的简写，当每一个文档由mongoose创建时就会自动添加，代表这该文档的版本，此属性可配置修改，默认为"__v",

作用是可以在"save文档"时作为一个查询条件，避免在"取出数据"到"save数据"的这段时间内，数据被其他进程修改而导致冲突。



> `versionKey`是首次由Mongoose创build时在每个文档上设置的属性。 该键值包含文档的内部修订版本。 此文档属性的名称是可configuration的。 默认是`__v` 。
>
> 如果这与你的应用程序冲突，你可以这样configuration：

```
 new Schema({..}, { versionKey: '_somethingElse' }) 
```

